<!--
META UBER - SISTEMA COMPLETO (VERS√ÉO CONSOLIDADA E EVOLU√çDA)
Autor: Projeto Meta Uber

OBJETIVO:
Sistema financeiro pessoal para motoristas (Uber/Apps)
Controle de metas, ganhos por turno, hist√≥rico, gr√°ficos e exporta√ß√£o

IMPORTANTE:
- Sistema 100% front-end
- Persist√™ncia via localStorage
- Seguran√ßa b√°sica (educacional / GitHub Pages)
- C√≥digo EXTREMAMENTE comentado para manuten√ß√£o futura
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meta Uber ‚Ä¢ Controle Financeiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonte moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js (Gr√°ficos profissionais) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- SheetJS (Excel) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <style>
  /* ======================================================
     RESET E BASE VISUAL
  ====================================================== */
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(rgba(0,0,0,.65), rgba(0,0,0,.65)),
    url('https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?auto=format&fit=crop&w=1600&q=80');
    background-size: cover;
    background-position: center;
    min-height: 100vh;
    color: #fff;
  }

  button { cursor: pointer; }

  /* ======================================================
     LOGIN / CADASTRO
  ====================================================== */
  .auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .auth-box {
    background: rgba(255,255,255,.95);
    color: #222;
    width: 100%;
    max-width: 380px;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 15px 40px rgba(0,0,0,.35);
  }

  .auth-box h2 { text-align: center; margin-bottom: 15px; }

  .auth-box input {
    width: 100%;
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .auth-box button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #1e3c72;
    color: #fff;
    font-weight: 600;
    margin-top: 5px;
  }

  .auth-box small { display:block; text-align:center; margin-top:8px; cursor:pointer; }

  /* ======================================================
     LAYOUT PRINCIPAL
  ====================================================== */
  .app { display: none; }

  .layout {
    display: grid;
    grid-template-columns: 230px 1fr;
    min-height: 100vh;
  }

  /* MENU LATERAL */
  .sidebar {
    background: #0f2027;
    padding: 20px;
  }

  .sidebar h3 { margin-bottom: 20px; }

  .sidebar button {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border: none;
    border-radius: 10px;
    background: #1e3c72;
    color: #fff;
    font-weight: 500;
    text-align: left;
  }

  /* CONTE√öDO */
  .content { padding: 25px; }

  .section { display: none; }
  .section.active { display: block; }

  /* ======================================================
     CARDS RESUMO
  ====================================================== */
  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .card {
    background: rgba(255,255,255,.95);
    color: #1e3c72;
    padding: 18px;
    border-radius: 14px;
    text-align: center;
  }

  .card strong { display:block; font-size: 1.4rem; margin-top: 5px; }

  /* BARRA DE PROGRESSO */
  .progress {
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress div {
    height: 16px;
    width: 0%;
    background: linear-gradient(135deg,#27ae60,#2ecc71);
  }

  /* ======================================================
     FORMUL√ÅRIOS
  ====================================================== */
  input {
    width: 100%;
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 6px;
    border: none;
  }

  /* ======================================================
     HIST√ìRICO
  ====================================================== */
  table {
    width: 100%;
    background: rgba(255,255,255,.95);
    color: #222;
    border-collapse: collapse;
  }

  th, td {
    padding: 8px;
    border-bottom: 1px solid #ccc;
    text-align: center;
  }

  th { background: #f0f3fa; }

  </style>
</head>
<body>

<!-- ======================================================
     LOGIN / CADASTRO / RESET (CORRIGIDO)
====================================================== -->
<div class="auth-container" id="auth">
  <div class="auth-box" id="loginBox">
    <h2>üîê Login</h2>
    <input id="loginUser" placeholder="Usu√°rio">
    <input id="loginPass" type="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <button onclick="mostrarCadastro()">Cadastrar</button>
    <small onclick="mostrarReset()">Esqueci a senha</small>
    <p id="authMsg"></p>
  </div>

  <div class="auth-box" id="cadastroBox" style="display:none">
    <h2>üìù Cadastro</h2>
    <input id="cadNome" placeholder="Nome completo">
    <input id="cadUser" placeholder="Usu√°rio">
    <input id="cadEmail" placeholder="E-mail">
    <input id="cadFone" placeholder="Celular">
    <input id="cadPass" type="password" placeholder="Senha">
    <button onclick="cadastrar()">Criar conta</button>
    <small onclick="voltarLogin()">Voltar</small>
    <p id="cadMsg"></p>
  </div>

  <div class="auth-box" id="resetBox" style="display:none">
    <h2>‚ôªÔ∏è Reset de senha</h2>
    <input id="resetUser" placeholder="Usu√°rio">
    <button onclick="resetSenhaConfirmar()">Resetar para 9999</button>
    <small onclick="voltarLogin()">Voltar</small>
    <p id="resetMsg"></p>
  </div>
</div>

<!-- ======================================================
     APLICA√á√ÉO
====================================================== -->
<div class="app" id="app">
  <div class="layout">

    <!-- MENU -->
    <div class="sidebar">
      <h3>üí∞ Meta Uber</h3>
      <button onclick="show('resumo')">üìä Resumo</button>
      <button onclick="show('ganhos')">üïí Ganhos do Dia</button>
      <button onclick="show('graficos')">üìà Gr√°ficos</button>
      <button onclick="show('historico')">üìÅ Hist√≥rico</button>
      <button onclick="logout()">üö™ Sair</button>
    </div>

    <!-- CONTE√öDO -->
    <div class="content">

      <!-- RESUMO -->
      <div class="section active" id="resumo">
        <div class="cards">
          <div class="card">Total Parcial<strong id="total">0</strong></div>
          <div class="card">Falta p/ Meta<strong id="falta">0</strong></div>
          <div class="card">Meta Di√°ria<strong id="metaDia">0</strong></div>
          <div class="card">Dias Restantes<strong id="dias">0</strong></div>
        </div>
        <div class="progress"><div id="barra"></div></div>
      </div>

      <!-- GANHOS -->
      <div class="section" id="ganhos">
        <h3>üïí Ganhos do Dia</h3>
        <input type="date" id="dia">
        <input placeholder="Manh√£" id="manha">
        <input placeholder="Tarde" id="tarde">
        <input placeholder="Noite" id="noite">
        <input placeholder="Gastos Extras" id="extra">
        <button onclick="salvarDia()">Salvar / Atualizar</button>
      </div>

      <!-- GR√ÅFICOS -->
      <div class="section" id="graficos">
        <canvas id="chart"></canvas>
      </div>

      <!-- HIST√ìRICO -->
      <div class="section" id="historico">
        <table>
          <thead>
            <tr><th>Data</th><th>Manh√£</th><th>Tarde</th><th>Noite</th><th>Extras</th><th>Total</th><th>A√ß√µes</th></tr>
          </thead>
          <tbody id="hist"></tbody>
        </table>
        <button onclick="exportExcel()">üì§ Exportar Excel</button>
      </div>

    </div>
  </div>
</div>

<script>
/* ======================================================
   AUTENTICA√á√ÉO, USU√ÅRIOS E DADOS (VERS√ÉO CORRIGIDA)
   REGRAS:
   - Usu√°rio + senha
   - N√£o permitir usu√°rio duplicado
   - Reset de senha para 9999
   - Dados salvos por usu√°rio
====================================================== */

// === BASE DE USU√ÅRIOS ===
let usuarios = JSON.parse(localStorage.getItem('usuarios')) || {};
let usuarioLogado = null;

function salvarUsuarios() {
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
}

/* ===================== TELAS ===================== */
function mostrarCadastro() {
  loginBox.style.display = 'none';
  cadastroBox.style.display = 'block';
  resetBox.style.display = 'none';
}

function mostrarReset() {
  loginBox.style.display = 'none';
  cadastroBox.style.display = 'none';
  resetBox.style.display = 'block';
}

function voltarLogin() {
  loginBox.style.display = 'block';
  cadastroBox.style.display = 'none';
  resetBox.style.display = 'none';
}

/* ===================== CADASTRO ===================== */
function cadastrar() {
  const nome = cadNome.value.trim();
  const user = cadUser.value.trim();
  const email = cadEmail.value.trim();
  const fone = cadFone.value.trim();
  const senha = cadPass.value.trim();

  if (!nome || !user || !senha) {
    cadMsg.innerText = '‚ö†Ô∏è Preencha todos os campos obrigat√≥rios';
    return;
  }

  if (usuarios[user]) {
    cadMsg.innerText = '‚ùå Usu√°rio j√° existe';
    return;
  }

  usuarios[user] = {
    nome,
    email,
    fone,
    senha,
    dados: {}
  };

  salvarUsuarios();
  cadMsg.innerText = '‚úÖ Cadastro realizado com sucesso';
}

/* ===================== LOGIN ===================== */
function login() {
  const user = loginUser.value.trim();
  const pass = loginPass.value.trim();

  if (!usuarios[user] || usuarios[user].senha !== pass) {
    authMsg.innerText = '‚ùå Usu√°rio ou senha inv√°lidos';
    return;
  }

  usuarioLogado = user;
  localStorage.setItem('logado', user);
  iniciarApp();
}

function logout() {
  localStorage.removeItem('logado');
  location.reload();
}

/* ===================== RESET DE SENHA ===================== */
function resetSenhaConfirmar() {
  const user = resetUser.value.trim();

  if (!usuarios[user]) {
    resetMsg.innerText = '‚ùå Usu√°rio n√£o encontrado';
    return;
  }

  usuarios[user].senha = '9999';
  salvarUsuarios();
  resetMsg.innerText = 'üîë Senha redefinida para 9999';
}

/* ===================== APP ===================== */
function iniciarApp() {
  auth.style.display = 'none';
  app.style.display = 'block';
  carregarDados();
  atualizarResumo();
  atualizarGrafico();
}

function show(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ===================== GANHOS ===================== */
function salvarDia() {
  const data = dia.value;
  if (!data) return;

  usuarios[usuarioLogado].dados[data] = {
    manha: +manha.value || 0,
    tarde: +tarde.value || 0,
    noite: +noite.value || 0,
    extra: +extra.value || 0
  };

  salvarUsuarios();
  carregarDados();
  atualizarResumo();
  atualizarGrafico();
}

function carregarDados() {
  const dados = usuarios[usuarioLogado].dados || {};
  hist.innerHTML = '';

  Object.keys(dados).sort().forEach(d => {
    const t = dados[d].manha + dados[d].tarde + dados[d].noite - dados[d].extra;
    hist.innerHTML += `
      <tr>
        <td>${d}</td>
        <td>${dados[d].manha}</td>
        <td>${dados[d].tarde}</td>
        <td>${dados[d].noite}</td>
        <td>${dados[d].extra}</td>
        <td>${t}</td>
        <td>
          <button onclick="editarDia('${d}')">‚úèÔ∏è</button>
          <button onclick="excluirDia('${d}')">üóëÔ∏è</button>
        </td>
      </tr>`;
  });
}

function editarDia(d) {
  const dados = usuarios[usuarioLogado].dados[d];
  dia.value = d;
  manha.value = dados.manha;
  tarde.value = dados.tarde;
  noite.value = dados.noite;
  extra.value = dados.extra;
  show('ganhos');
}

function excluirDia(d) {
  delete usuarios[usuarioLogado].dados[d];
  salvarUsuarios();
  carregarDados();
  atualizarResumo();
  atualizarGrafico();
}

/* ===================== RESUMO ===================== */
function atualizarResumo() {
  const dados = usuarios[usuarioLogado].dados || {};
  let soma = 0;

  Object.values(dados).forEach(v => {
    soma += v.manha + v.tarde + v.noite - v.extra;
  });

  const meta = 1500;
  const diasRestantes = 5;
  const falta = Math.max(0, meta - soma);

  total.innerText = `R$ ${soma.toFixed(2)}`;
  faltaEl.innerText = `R$ ${falta.toFixed(2)}`;
  metaDia.innerText = `R$ ${(falta / diasRestantes).toFixed(2)}`;
  dias.innerText = diasRestantes;
  barra.style.width = `${Math.min((soma / meta) * 100, 100)}%`;
}

/* ===================== GR√ÅFICO ===================== */
let grafico;
function atualizarGrafico() {
  const dados = usuarios[usuarioLogado].dados || {};
  const labels = [];
  const valores = [];

  Object.keys(dados).sort().forEach(d => {
    labels.push(d);
    valores.push(dados[d].manha + dados[d].tarde + dados[d].noite - dados[d].extra);
  });

  if (grafico) grafico.destroy();

  grafico = new Chart(chart, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Lucro Di√°rio',
        data: valores,
        borderColor: '#2ecc71',
        backgroundColor: 'rgba(46,204,113,.25)',
        tension: 0.4
      }]
    }
  });
}

/* ===================== AUTO LOGIN ===================== */
const auto = localStorage.getItem('logado');
if (auto && usuarios[auto]) {
  usuarioLogado = auto;
  iniciarApp();
}
</script>
</body>
</html>
